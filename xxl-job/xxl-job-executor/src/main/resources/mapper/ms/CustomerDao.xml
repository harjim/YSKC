<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xxl.job.executor.dao.ms.CustomerDao">
    <insert id="InsertH3Customers">
        INSERT INTO `h3_customer`
        (`objectid`,
        `name`,
        `createdBy`,
        `createdTime`,
        `modifiedBy`,
        `modifiedTime`,
        `workflowInstanceId`,
        `status`,
        `clientName`,
        `strategicLevel`,
        `clientLevel`,
        `salesRegion`,
        `contactName`,
        `mobile`,
        `f0000003`,
        `f0000027`,
        `addr`,
        `salesOpportunitie`,
        `f0000022`,
        `ownerId`,
        `ownerDeptId`,
        `origin`,
        `bank`,
        `accountNumber`,
        `address`,
        `taxID`,
        `clientFPName`,
        `f0000038`,
        `salesAssistant`,
        `f0000039`,
        `f0000029`,
        `f0000033`,
        `f0000031`,
        `f0000034`,
        `f0000036`,
        `f0000037`,
        `synDataDateTime`)
        VALUES
        <foreach collection="customerList" item="item" index="index"
                 separator=",">
            (#{item.ObjectId},
            #{item.Name},
            #{item.CreatedBy},
            #{item.CreatedTime},
            #{item.ModifiedBy},
            #{item.ModifiedTime},
            #{item.WorkflowInstanceId},
            #{item.Status},
            #{item.ClientName},
            #{item.StrategicLevel},
            #{item.ClientLevel},
            #{item.SalesRegion},
            #{item.ContactName},
            #{item.Mobile},
            #{item.F0000003},
            #{item.F0000027},
            #{item.Addr},
            #{item.SalesOpportunitie},
            #{item.F0000022},
            #{item.OwnerId},
            #{item.OwnerDeptId},
            #{item.Origin},
            #{item.Bank},
            #{item.AccountNumber},
            #{item.Address},
            #{item.TaxID},
            #{item.ClientFPName},
            #{item.F0000038Name},
            #{item.SalesAssistant},
            #{item.F0000039},
            #{item.F0000029},
            #{item.F0000033},
            #{item.F0000031},
            #{item.F0000034},
            #{item.F0000036},
            #{item.F0000037},
            #{item.synDataDateTime})
        </foreach>
        ON DUPLICATE KEY UPDATE
        `name`=values(name),
        `createdBy`=values(createdBy),
        `createdTime`=values(createdTime),
        `modifiedBy`=values(modifiedBy),
        `modifiedTime`=values(modifiedTime),
        `status`=values(status),
        `clientName`=values(clientName),
        `strategicLevel`=values(strategicLevel),
        `clientLevel`=values(clientLevel),
        `salesRegion`=values(salesRegion),
        `contactName`=values(contactName),
        `mobile`=values(mobile),
        `f0000003`=values(f0000003),
        `f0000027`=values(f0000027),
        `addr`=values(addr),
        `salesOpportunitie`=values(salesOpportunitie),
        `f0000022`=values(f0000022),
        `ownerId`=values(ownerId),
        `ownerDeptId`=values(ownerDeptId),
        `origin`=values(origin),
        `bank`=values(bank),
        `accountNumber`=values(accountNumber),
        `address`=values(address),
        `taxID`=values(taxID),
        `clientFPName`=values(clientFPName),
        `f0000038`=values(f0000038),
        `salesAssistant`=values(salesAssistant),
        `f0000039`=values(f0000039),
        `f0000029`=values(f0000029),
        `f0000033`=values(f0000033),
        `f0000031`=values(f0000031),
        `f0000034`=values(f0000034),
        `f0000036`=values(f0000036),
        `f0000037`=values(f0000037),
        synDataDateTime=values(synDataDateTime);
    </insert>
    <insert id="insertH3Projects">
        INSERT INTO `msdb`.`h3_project`
        (`objectId`,
        `F0000006`,
        `F0000534`,
        `ProjectYear`,
        `Sales`,
        `OwnerDeptId`,
        `F0000523`,
        `F0000524`,
        `F0000111`,
        `F0000112`,
        `F0000114`,
        `F0000115`,
        `F0000537`,
        `F0000538`,
        `F0000539`,
        `F0000540`,
        `F0000541`,
        `F0000542`,
        `CreatedTime`,
        `ModifiedTime`)
        VALUES
        <foreach collection="projectList" item="item" index="index" separator=",">
            (#{item.ObjectId},
            #{item.F0000006},
            #{item.F0000534},
            #{item.ProjectYear},
            #{item.Sales},
            #{item.OwnerDeptId},
            #{item.F0000523Name},
            #{item.F0000524Name},
            #{item.F0000111},
            #{item.F0000112},
            #{item.F0000114},
            #{item.F0000115},
            #{item.F0000537},
            #{item.F0000538},
            #{item.F0000539},
            #{item.F0000540},
            #{item.F0000541},
            #{item.F0000542},
            #{item.CreatedTime},
            #{item.ModifiedTime})
        </foreach>
        ON DUPLICATE KEY UPDATE
        F0000006=values(F0000006),
        F0000534=values(F0000534),
        ProjectYear=values(ProjectYear),
        Sales=values(Sales),
        OwnerDeptId=values(OwnerDeptId),
        F0000523=values(F0000523),
        F0000524=values(F0000524),
        F0000111=values(F0000111),
        F0000112=values(F0000112),
        F0000114=values(F0000114),
        F0000115=values(F0000115),
        F0000537=values(F0000537),
        F0000538=values(F0000538),
        F0000539=values(F0000539),
        F0000540=values(F0000540),
        F0000541=values(F0000541),
        F0000542=values(F0000542),
        CreatedTime=values(CreatedTime),
        ModifiedTime=values(ModifiedTime);
    </insert>
    <update id="updateCustomer">
        update customer set owerId = null, deptId = null, status = 0, effectDate = null
        where (status = 10 and #{inviteDate} >= effectDate)
           or (status = 20 and #{visitDate} >= effectDate)
    </update>
    <select id="countCustomer" resultType="java.lang.Integer">
        select COUNT(id) from customer
    </select>
</mapper>